---
contributors: stevenpaulhoward, multitudes
---

Speakers: Niels Gabel, Materials Engineer

# Chapters
[0:00 - Introduction](https://developer.apple.com/videos/play/wwdc2023/10202/?time=0)  
[0:55 - Materials in xrOS](https://developer.apple.com/videos/play/wwdc2023/10202/?time=55)  
[3:38 - Material editing](https://developer.apple.com/videos/play/wwdc2023/10202/?time=218)  
[10:26 - Node graphs](https://developer.apple.com/videos/play/wwdc2023/10202/?time=626)  
[13:16 - Geometry modifiers](https://developer.apple.com/videos/play/wwdc2023/10202/?time=796)  
[19:14 - Wrap-up](https://developer.apple.com/videos/play/wwdc2023/10202/?time=1154)  

<!-- The timestamp was redundant because already set above...-->

# Materials in visionOS

![What Are Materials][whatAreMaterials]

[whatAreMaterials]: ../../../images/notes/wwdc23/10202/whatAreMaterials.jpg

Materials are what define the appearance of your object in 3D scenes. Materials can be simple, just a single color, or they can use images.You might apply a wood texture to the model of a chair or map an image of bricks to a wall. Materials can also be quite sophisticated. They might use animation to look like rippling water or change appearance based on viewing angle. Think of the iridescent sparkle of mother of pearl. Materials can even modify the geometry of the objects they are applied to. _

## Physically Based Rendering
Materials in visionOS use Physically Based Rendering (PBR) to represent physical properties of real world objects, for example, how metallic or how rough an object looks.  
Let's look at some examples of physically based materials in action.


![Physically Based Rendering example][pbr]

[pbr]: ../../../images/notes/wwdc23/10202/pbr.jpg

Materials consist of one or more **shaders**. These are programs that do the actual work of computing the appearance of their material.

![shaders][shaders]

[shaders]: ../../../images/notes/wwdc23/10202/shaders.jpg
With RealityKit 2 for iOS and iPadOS, we introduced CustomMaterial. Shaders in CustomMaterial are hand coded in Metal.

![Shaders in CustomMaterial are hand coded in Metal][metal]

[metal]: ../../../images/notes/wwdc23/10202/metal.jpg

**Surface shaders** operate on the PBR attributes of models. **Geometry modifiers** operate on the geometry of your objects.

## ShaderGraphMaterial

In xrOS, a new type of material is introduced: **ShaderGraphMaterial**.

![shaderGraphMaterial][shaderGraphMaterial]

[shaderGraphMaterial]: ../../../images/notes/wwdc23/10202/shaderGraphMaterial.jpg

**This is the exclusive way of creating custom materials for visionOS**.Based on the open standard [MaterialX](https://materialx.org).

Supports 2 main types of shaders: **Physically Based** and **Custom**.

![shaderGraphMaterial][shaderGraphMaterial2]

[shaderGraphMaterial2]: ../../../images/notes/wwdc23/10202/shaderGraphMaterial2.jpg

- _Physically based shader is intended for simpler use cases (e.g. constant, non-changing values)_
- _Custom is intended for precise and custom control over 3D objects (e.g. animation, geometry modifiers, special effects, etc._)

ShaderGraphMaterial supports two main types of shaders, which we call Physically Based and Custom. Physically Based is a basic PBR shader. Choose this for simpler use cases. You configure this shader by providing constant, nonchanging values, like colors or images, for each property. Custom shaders, on the other hand, give you precise and custom control over the appearance of your 3D objects.  
Custom shaders can incorporate animation, adjust your object's geometry, and create special effects on the surface of your object, like a sparkly paint look.  
You can build ShaderGraphMaterials using the Shader Graph editor right inside Reality Composer Pro. Take a look at the Shader Graph nodes below that instantaneously define the look of the terrain in the viewport. 

![shaderGraphMaterial][shaderGraphMaterial3]

[shaderGraphMaterial3]: ../../../images/notes/wwdc23/10202/shaderGraphMaterial3.jpg

<!-- The timestamp was redundant because already set above...-->
# Material editing
Materials in xrOS can be created using Reality Composer Pro
![Reality Composer Pro][realityComposerPro]

[realityComposerPro]: ../../../images/notes/wwdc23/10202/realityComposerPro.jpg

If you'd like an introduction to the app before starting with materials, please watch:
[Meet Reality Composer Pro](https://developer.apple.com/videos/play/wwdc2023/10083)

We'll use the Yosemite Valley model that was shown in that session and apply a topographical map appearance to it. I'll explain the math behind our material, then we'll go into Reality Composer Pro's shader editor and build it.  
To save on time, I hid all the objects we don't need for this session using the Deactivate command.

![the Yosemite Valley model in Reality Composer Pro][yosemiteModel]

[yosemiteModel]: ../../../images/notes/wwdc23/10202/yosemiteModel.jpg

## Topography map
Let's add a topography feature. We'll add a material showing the topography of our model by displaying contour lines along the slope of the terrain. It'll look similar to the topographical map that you might have come across when planning a hike. 

![the Yosemite Valley model finished version in Reality Composer Pro][yosemiteModelTopographic]

[yosemiteModelTopographic]: ../../../images/notes/wwdc23/10202/yosemiteModelTopographic.jpg

Let's create a custom material containing a shader that will draw contour lines on our terrain. We want to draw lines on our terrain through all the areas that have the same elevation, like in this diagram. This blue line, for example, shows all points on the terrain at 1000 meters of elevation. Seen from above, it will look something like the diagram on the right.

![the Yosemite Valley model in Reality Composer Pro][yosemiteModel2]

[yosemiteModel2]: ../../../images/notes/wwdc23/10202/yosemiteModel2.jpg

Add a material by clicking the `+` icon inside the Project Browser. Under Materials, notice our two shader types: Physically Based and Custom. Choose Custom.

![the Yosemite Valley model in Reality Composer Pro][yosemiteModel3]

[yosemiteModel3]: ../../../images/notes/wwdc23/10202/yosemiteModel3.jpg

This reveals the Shader Graph of our editor.

![the Yosemite Valley model in Reality Composer Pro][yosemiteModel4]

[yosemiteModel4]: ../../../images/notes/wwdc23/10202/yosemiteModel4.jpg

New custom shaders start with two nodes, the surface node in purple and the outputs node in blue. Your material's active surface is the one connected to the custom surface input of the outputs node. The inputs on the surface are how you set your shader's physically based, or PBR, parameters. Base color, for example.

Let's give the material a descriptive name. TopographyMaterial sounds good. An important step is to assign our new material to our Yosemite Valley model. Select it in the project hierarchy. In the inspector, under Material Bindings, choose TopographyMaterial from the Binding menu.

![the Yosemite Valley model][yosemiteModel5]

[yosemiteModel5]: ../../../images/notes/wwdc23/10202/yosemiteModel5.jpg

Notice the model changes from color to a simple gray. Our material is working, but it doesn't do anything interesting yet. Let's fix that. Select TopographyMaterial from the hierarchy to return to the Shader Graph editor. We'll connect some nodes to our surface inputs to draw stripes on our model in the right places.

I'll illustrate how our material will work with this example terrain. We need our material to decide where to draw topographical lines based on its location on our model. So first we'll add a position node to our material. This node returns our rendering position in 3D space. We're only interested in the height of position, so we'll also add a node called separate to extract just the position's Y-coordinate. Separate returns the Y-coordinate position, which increases with terrain height.

![the Yosemite Valley model][yosemiteModel6]

[yosemiteModel6]: ../../../images/notes/wwdc23/10202/yosemiteModel6.jpg

Let's add these first two nodes to our material in Reality Composer Pro. Double-click on the background of the editor to add nodes. This brings up the New Node picker. You can browse through the list of all the available nodes, or search for nodes by name or keyword. Let's type "position" and select the Position node from the list to insert it into our shader. Position outputs the location in 3D space where the material is being rendered.

![the Yosemite Valley model][yosemiteModel7]

[yosemiteModel7]: ../../../images/notes/wwdc23/10202/yosemiteModel7.jpg

Our material varies with height, so let's add a separate node to extract the Y component of position. Double-click the background to bring up the New Node picker again and add a Separate 3 node. To make connections in the editor, just click and drag from node outputs to node inputs like this. 

![the Yosemite Valley model][yosemiteModel8]

[yosemiteModel8]: ../../../images/notes/wwdc23/10202/yosemiteModel8.jpg

These two nodes combined give us the height of the terrain. Next, we'll take the output of the separate node and pass it to a modulo node. Modulo gives the remainder of dividing two values. We'll use modulo to divide height by our desired topographical line spacing. The result looks like this. You can see height has been divided into bands. The height values inside each range start at 0 and increase to that range's height. This will be important for our next step.

![the Yosemite Valley model][yosemiteModel9]

[yosemiteModel9]: ../../../images/notes/wwdc23/10202/yosemiteModel9.jpg


  Let's add the modulo node to our material in Reality Composer Pro. Instead of double-clicking to add a node and then connecting it, we can drag a new connection to an empty space to create a node that's already connected in one step. In the New Node picker, type "modulo" and click to insert a Modulo node. Modulo has two inputs. The first is the dividend and the second is the divisor. You can conveniently set constant values on inputs in the inspector instead of connecting nodes. In the inspector, change the second argument to 0.1. This is the divisor and sets the width of our height ranges. 

![the Yosemite Valley model][yosemiteModel10]

[yosemiteModel10]: ../../../images/notes/wwdc23/10202/yosemiteModel10.jpg

We have just one more step to go before we can see our output. We'll use an ifgreater node to determine where our repeating values fall in narrow height bands on our terrain. The ifgreater node will return a value representing one of the two band colors you see on screen, depending on the result of a comparison. When the height is greater than our shader topographical line width, we'll choose a background color. And where the height falls within our desired line width, we'll choose our topography line color.

![the Yosemite Valley model][yosemiteModel11]

[yosemiteModel11]: ../../../images/notes/wwdc23/10202/yosemiteModel11.jpg

 Let's add the ifgreater node to our material and see the results. We want to compare the result of the modulo node to a value we choose for our topographical line width. So I'll add an ifgreater node to do that comparison. Ifgreater compares its two inputs and returns one value when its first input is greater than its second input, and a different value when the first input is less than its second input. This ifgreater node is set to output floating point values, but we want to choose between two colors, one for our terrain and one for our topographical lines. In the inspector, under Type, change this node to output RGB. Next, let's pick our two colors.
 
![the Yosemite Valley model][yosemiteModel12]

[yosemiteModel12]: ../../../images/notes/wwdc23/10202/yosemiteModel12.jpg
 
 In the inspector, I'll click on the color picker next to True Result and set our terrain color. Let's use white.  
Let's leave the False Result, which is our topographical line color, set to black.

This will give us a lot of contrast with our white terrain. I tried a bunch of values and arrived at 0.002 as a good value for line width, so in the inspector, I'll set my comparison value to 0.002. I'll connect the ifgreater node's output to our surface's Diffuse Color input. Awesome, now our material is setting the color at every point on our terrain and we've made a topographical lines material.

![the Yosemite Valley model][yosemiteModel13]

[yosemiteModel13]: ../../../images/notes/wwdc23/10202/yosemiteModel13.jpg




This section jumps right into a walk-through tutorial on applying topography lines to a geographical diorama. Starts at [4:31](https://developer.apple.com/videos/play/wwdc2023/10202?time=271)

**Important!** make sure you assign your new material to your model in the hierarchy. You do this by selecting your custom material from the model's Material Binding dropdown in the inspector [5:48](https://developer.apple.com/videos/play/wwdc2023/10202?time=349).

<!-- The timestamp was redundant because already set above...-->
# Node graphs 
> _Node graphs help simplify complex materials and let you create your own nodes to reuse parts of graphs._

We'll use node graphs to give a material a real topographical map look. Let's add a second set of lines between the current lines of our material.  

Here's what our material looks like so far. 

![the Yosemite Valley model][nodeGraphs]

[nodeGraphs]: ../../../images/notes/wwdc23/10202/nodeGraphs.jpg

And here's what it will look like when we add our subdivisions.

![the Yosemite Valley model][nodeGraphs]

[nodeGraphs]: ../../../images/notes/wwdc23/10202/nodeGraphs.jpg



**Quick Tips**
- Multi-select any set of nodes and right-click > Compose Node Graph to make reusable node components [11:21](https://developer.apple.com/videos/play/wwdc2023/10202?time=681).
- In the project hierarchy, right-click > Create Instance to create an instance of your node graph [11:35](https://developer.apple.com/videos/play/wwdc2023/10202?time=695).
- Add inputs and outputs to your node graph in the inspector [12:10](https://developer.apple.com/videos/play/wwdc2023/10202?time=730).

**Instances** of node graphs are live copies that **adopt any changes made to the original node graph**. They inherit inputs and outputs added to the original node graph it points to.

<!-- The timestamp was redundant because already set above...-->
# Geometry modifiers 
> _A feature of custom materials you can use to modify your models in real time._

**Reminder** _Surface shaders operate on the PBR attributes while Geometry modifiers operate on the geometry of objects._

This section jumps right into a walk-through tutorial on applying heightmaps to generate geometry, and animating between those heightmaps. Starts at [13:46](https://developer.apple.com/videos/play/wwdc2023/10202?time=826).

![Visualization of a geometry modifier constructed with heightmap data.][heightmap]

[heightmap]: ../../../images/notes/wwdc23/10202/heightmap.png

In order to build a geometry modifier, you need to add a `Geometry Modifier Input` node, and connect it to the output node [15:23](https://developer.apple.com/videos/play/wwdc2023/10202?time=923).

Geometry modifiers can move the vertices of geometry in any direction. To specify a direction to move vertices, use the `Combine3` node to create a 3D vector and set it to the XYZ axis you want to manipulate [16:15](https://developer.apple.com/videos/play/wwdc2023/10202?time=975).

### How to add a normal map to geometry [16:53](https://developer.apple.com/videos/play/wwdc2023/10202?time=1013)

1. Add an `Image` node and input the normal map.
2. Use a `Remap` node to adjust normal range from 0:1 to -1:1 if needed.

### How to dynamically animate between geometry modifiers [17:26](https://developer.apple.com/videos/play/wwdc2023/10202?time=1046)

![Schematic of how to use the mix node to animate between geometry modifiers.][mix-node]

[mix-node]: ../../../images/notes/wwdc23/10202/mix-node.png

1. Add `Mix` nodes to blend between 2 sets of texture maps.
2. Add and connect a `Constant` to the `Mix` nodes, and set the value between 0:1 to control which texture set is shown.
3. Right click the `Constant` node, and convert it using the Promote command.
4. Dynamically animate inside your Swift code. Walk-through of this step can be found in the session [Work with Reality Composer Pro content in Xcode](https://developer.apple.com/videos/play/wwdc2023/10273).

## Resources
[Diorama](https://developer.apple.com/documentation/visionOS/diorama)  
[Have a question? Ask with tag wwdc2023-10202](https://developer.apple.com/forums/create/question?&tag1=760030&tag2=796030)  
[Search the forums for tag wwdc2023-10202](https://developer.apple.com/forums/tags/wwdc2023-10202)

## Related Videos

[Build great games for spatial computing](https://developer.apple.com/videos/play/wwdc2023/10096)  
[Explore rendering for spatial computing](https://developer.apple.com/videos/play/wwdc2023/10095)  
[Explore the USD ecosystem](https://developer.apple.com/videos/play/wwdc2023/10086)  
[Meet Reality Composer Pro](https://developer.apple.com/videos/play/wwdc2023/10083)  
[Optimize app power and performance for spatial computing](https://developer.apple.com/videos/play/wwdc2023/10100)  
[Work with Reality Composer Pro content in Xcode](https://developer.apple.com/videos/play/wwdc2023/10273)
